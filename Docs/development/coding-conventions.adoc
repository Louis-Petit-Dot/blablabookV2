= BlaBlaBook V2 - Coding Conventions / Conventions de Code
:toc: left
:toclevels: 3
:sectanchors:
:icons: font
:version: 2.0
:date: {docdate}

// Navigation inter-documents
link:../README.adoc[ğŸ“š Documentation Hub] |
link:../cdc/business-requirements.adoc[ğŸ“‹ Business] |
link:../cdc/technical-architecture.adoc[ğŸ—ï¸ Architecture] |
link:../cdc/api-specifications.adoc[ğŸ›£ï¸ API] |
link:../cdc/risk-analysis.adoc[âš ï¸ Risks]

// Navigation langues
<<section-fr,ğŸ‡«ğŸ‡· Version FranÃ§aise>> | <<section-en,ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ English Version>>

---

[[section-fr]]
== ğŸ‡«ğŸ‡· Conventions de Code

<<section-en,ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ Switch to English>> | ğŸ‡«ğŸ‡· *FranÃ§ais*

=== ğŸ“‹ RÃ¨gles GÃ©nÃ©rales

==== Langue et Encodage

[cols="2,3,2"]
|===
|Ã‰lÃ©ment |Convention |Exemple

|**Code source**
|100% anglais, sans accents, sans emojis
|`getUserLibrary()`, `bookStatus`

|**Commentaires**
|FranÃ§ais, premiÃ¨re personne singulier, sans accents
|`// Je recupere la liste des livres`

|**Documentation**
|FranÃ§ais/Anglais selon contexte (voir navigation)
|Fichiers `.adoc` avec sections FR/EN

|**Variables temporaires**
|Anglais court, explicite
|`temp`, `result`, `data`

|**Messages d'erreur**
|Anglais technique (logs), franÃ§ais utilisateur (UI)
|`Invalid JWT token` / `Mot de passe incorrect`
|===

=== ğŸ—ï¸ Conventions de Nommage

==== ModÃ¨les de DonnÃ©es (Drizzle)

**RÃ¨gle : PascalCase avec majuscule initiale**

```typescript
// âœ… Correct
export const User = pgTable('users', { ... });
export const ReadingList = pgTable('reading_lists', { ... });
export const BookAuthor = pgTable('book_authors', { ... });

// âŒ Incorrect
export const user = pgTable('users', { ... });
export const reading_list = pgTable('reading_lists', { ... });
```

==== Variables et Fonctions

**RÃ¨gle : camelCase sauf incompatibilitÃ©s techno**

```typescript
// âœ… Variables et fonctions
const userId = 123;
const bookTitle = "Dune";
function getUserLibrary() { ... }
async function createReadingList() { ... }

// âœ… Constantes globales
const JWT_SECRET = "secret";
const API_BASE_URL = "https://api.blablabook.com";

// âœ… Interfaces TypeScript
interface UserProfile {
  firstName: string;
  lastName: string;
  createdAt: Date;
}

// âœ… Types union
type BookStatus = 'read' | 'toRead' | 'currentlyReading';
```

==== Fichiers et Dossiers

**RÃ¨gle : kebab-case pour fichiers, camelCase pour dossiers de composants**

```
src/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.ts               # snake_case pour correspondre aux tables
â”‚   â”œâ”€â”€ reading-list.ts       # kebab-case gÃ©nÃ©ral
â”‚   â””â”€â”€ book-author.ts
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth-routes.ts
â”‚   â”œâ”€â”€ user-routes.ts
â”‚   â””â”€â”€ library-routes.ts
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ jwt-validation.ts
â”‚   â””â”€â”€ rate-limiting.ts
â””â”€â”€ utils/
    â”œâ”€â”€ password-hash.ts
    â””â”€â”€ api-response.ts
```

=== ğŸ’¬ Conventions de Commentaires

==== Style de Commentaires

**RÃ¨gle : FranÃ§ais, premiÃ¨re personne, sans accents, explicatif**

```typescript
// âœ… Correct - FranÃ§ais 1Ã¨re personne sans accents
function validateUserInput(data: unknown) {
  // Je verifie que les donnees sont valides avant traitement
  if (!data) {
    // Je retourne une erreur si les donnees sont manquantes
    throw new Error('Missing data');
  }

  // Je valide le schema avec Drizzle-Zod
  return userSchema.parse(data);
}

// âŒ Incorrect - Anglais ou accents
// I validate the user input data
// Je vÃ©rifie que les donnÃ©es sont valides
```

==== Documentation de Fonctions

**RÃ¨gle : JSDoc en franÃ§ais sans accents + types TypeScript**

```typescript
/**
 * Je recupere la bibliotheque personnelle d'un utilisateur
 * @param userId - Identifiant unique de l'utilisateur
 * @param status - Filtre optionnel par statut de lecture
 * @returns Promise resolue avec la liste des livres
 */
async function getUserLibrary(
  userId: number,
  status?: BookStatus
): Promise<BookWithStatus[]> {
  // Je construis la requete de base
  const baseQuery = db
    .select()
    .from(UserBooks)
    .where(eq(UserBooks.userId, userId));

  // J'ajoute le filtre de statut si fourni
  if (status) {
    baseQuery.where(eq(UserBooks.status, status));
  }

  return await baseQuery;
}
```

=== ğŸ¯ Conventions SpÃ©cifiques par Technologie

==== Deno & TypeScript

**Imports et Exports**

```typescript
// âœ… Imports groupÃ©s et ordonnÃ©s
import { serve } from "https://deno.land/std@0.200.0/http/server.ts";
import { Hono } from "https://deno.land/x/hono@v3.12.0/mod.ts";

import { User, ReadingList } from "./models/index.ts";
import { validateJWT } from "./middleware/auth.ts";

// âœ… Exports nommÃ©s privilÃ©giÃ©s
export { getUserLibrary, createBook };
export type { BookStatus, UserProfile };
```

**Permissions Deno explicites**

```typescript
// deno.json - Je definis les permissions necessaires
{
  "tasks": {
    "dev": "deno run --allow-net --allow-read --allow-env src/main.ts"
  }
}
```

==== Drizzle ORM

**SchÃ©mas de tables**

```typescript
// âœ… Noms de tables en snake_case (PostgreSQL convention)
export const User = pgTable('users', {
  id: serial('id').primaryKey(),
  firstName: varchar('first_name', { length: 100 }).notNull(),
  lastName: varchar('last_name', { length: 100 }).notNull(),
  createdAt: timestamp('created_at').defaultNow(),
});

// âœ… Relations avec noms explicites
export const UserRelations = relations(User, ({ many }) => ({
  libraries: many(Library),
  readingLists: many(ReadingList),
}));
```

**RequÃªtes Drizzle**

```typescript
// âœ… Requetes lisibles avec alias explicites
const userWithBooks = await db
  .select({
    userId: User.id,
    userName: User.firstName,
    bookTitle: Book.title,
    readingStatus: UserBooks.status,
  })
  .from(User)
  .leftJoin(UserBooks, eq(User.id, UserBooks.userId))
  .leftJoin(Book, eq(UserBooks.bookId, Book.id))
  .where(eq(User.id, userId));
```

==== Hono Framework

**Routes et Middleware**

```typescript
// âœ… Routes groupÃ©es logiquement
const authRoutes = new Hono();

authRoutes.post('/login', async (c) => {
  // Je recupere les donnees de connexion
  const { email, password } = await c.req.json();

  // Je valide les donnees avec le schema
  const validatedData = loginSchema.parse({ email, password });

  // Je continue le processus d'authentification...
});

// âœ… Middleware avec noms explicites
app.use('/api/*', jwtAuthMiddleware);
app.use('/api/admin/*', adminOnlyMiddleware);
```

=== ğŸ”’ Conventions de SÃ©curitÃ©

==== Gestion des Secrets

```typescript
// âœ… Variables d'environnement en UPPER_SNAKE_CASE
const JWT_SECRET = Deno.env.get('JWT_SECRET');
const DATABASE_URL = Deno.env.get('DATABASE_URL');

// âŒ Jamais de secrets en dur
const jwtSecret = 'mon-secret-super-securise'; // INTERDIT
```

==== Validation des DonnÃ©es

```typescript
// âœ… Toujours valider les entrees utilisateur
app.post('/api/users', async (c) => {
  try {
    // Je recupere et valide les donnees
    const rawData = await c.req.json();
    const validatedUser = createUserSchema.parse(rawData);

    // Je continue le traitement...
  } catch (error) {
    // Je log l'erreur technique en anglais
    console.error('User validation failed:', error);

    // Je retourne une erreur utilisateur en franÃ§ais
    return c.json({ error: 'Donnees utilisateur invalides' }, 400);
  }
});
```

=== ğŸ“ Conventions de Documentation

==== Fichiers README

```markdown
# Nom du Module

## Description
Je decris brievement le role du module sans accents.

## Installation
\`\`\`bash
deno install --allow-net module.ts
\`\`\`

## Utilisation
\`\`\`typescript
// J'importe le module
import { functionName } from "./module.ts";

// Je l'utilise dans mon code
const result = functionName();
\`\`\`
```

==== Messages de Commit Git

**Format : `type(scope): description en anglais`**

```bash
# âœ… Commits en anglais, concis
git commit -m "feat(auth): add JWT stateless authentication"
git commit -m "fix(db): resolve user query performance issue"
git commit -m "docs(api): update endpoint specifications"

# âŒ Commits en franÃ§ais ou avec accents
git commit -m "ajout authentification JWT"
git commit -m "correction problÃ¨me performance"
```

=== ğŸ§ª Conventions de Tests

**Noms de tests explicites**

```typescript
// âœ… Tests en anglais avec description claire
Deno.test("getUserLibrary should return user books with correct status", async () => {
  // J'arrange les donnees de test
  const userId = 1;
  const expectedStatus = 'read';

  // J'execute la fonction testee
  const result = await getUserLibrary(userId, expectedStatus);

  // Je verifie le resultat
  assertEquals(result.length, 3);
  assertTrue(result.every(book => book.status === expectedStatus));
});
```

---

[[section-en]]
== ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ Coding Conventions

ğŸ‡¬ğŸ‡§ğŸ‡ºğŸ‡¸ *English* | <<section-fr,ğŸ‡«ğŸ‡· Passer au FranÃ§ais>>

=== ğŸ“‹ General Rules

==== Language and Encoding

[cols="2,3,2"]
|===
|Element |Convention |Example

|**Source code**
|100% English, no accents, no emojis
|`getUserLibrary()`, `bookStatus`

|**Comments**
|French, first person singular, no accents
|`// Je recupere la liste des livres`

|**Documentation**
|French/English depending on context (see navigation)
|`.adoc` files with FR/EN sections

|**Temporary variables**
|Short English, explicit
|`temp`, `result`, `data`

|**Error messages**
|Technical English (logs), French user (UI)
|`Invalid JWT token` / `Mot de passe incorrect`
|===

=== ğŸ—ï¸ Naming Conventions

==== Data Models (Drizzle)

**Rule: PascalCase with initial capital**

```typescript
// âœ… Correct
export const User = pgTable('users', { ... });
export const ReadingList = pgTable('reading_lists', { ... });
export const BookAuthor = pgTable('book_authors', { ... });

// âŒ Incorrect
export const user = pgTable('users', { ... });
export const reading_list = pgTable('reading_lists', { ... });
```

==== Variables and Functions

**Rule: camelCase except for tech incompatibilities**

```typescript
// âœ… Variables and functions
const userId = 123;
const bookTitle = "Dune";
function getUserLibrary() { ... }
async function createReadingList() { ... }

// âœ… Global constants
const JWT_SECRET = "secret";
const API_BASE_URL = "https://api.blablabook.com";

// âœ… TypeScript interfaces
interface UserProfile {
  firstName: string;
  lastName: string;
  createdAt: Date;
}

// âœ… Union types
type BookStatus = 'read' | 'toRead' | 'currentlyReading';
```

==== Files and Folders

**Rule: kebab-case for files, camelCase for component folders**

```
src/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.ts               # snake_case to match tables
â”‚   â”œâ”€â”€ reading-list.ts       # general kebab-case
â”‚   â””â”€â”€ book-author.ts
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth-routes.ts
â”‚   â”œâ”€â”€ user-routes.ts
â”‚   â””â”€â”€ library-routes.ts
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ jwt-validation.ts
â”‚   â””â”€â”€ rate-limiting.ts
â””â”€â”€ utils/
    â”œâ”€â”€ password-hash.ts
    â””â”€â”€ api-response.ts
```

=== ğŸ’¬ Comment Conventions

==== Comment Style

**Rule: French, first person, no accents, explanatory**

```typescript
// âœ… Correct - French 1st person without accents
function validateUserInput(data: unknown) {
  // Je verifie que les donnees sont valides avant traitement
  if (!data) {
    // Je retourne une erreur si les donnees sont manquantes
    throw new Error('Missing data');
  }

  // Je valide le schema avec Drizzle-Zod
  return userSchema.parse(data);
}

// âŒ Incorrect - English or accents
// I validate the user input data
// Je vÃ©rifie que les donnÃ©es sont valides
```

==== Function Documentation

**Rule: JSDoc in French without accents + TypeScript types**

```typescript
/**
 * Je recupere la bibliotheque personnelle d'un utilisateur
 * @param userId - Identifiant unique de l'utilisateur
 * @param status - Filtre optionnel par statut de lecture
 * @returns Promise resolue avec la liste des livres
 */
async function getUserLibrary(
  userId: number,
  status?: BookStatus
): Promise<BookWithStatus[]> {
  // Je construis la requete de base
  const baseQuery = db
    .select()
    .from(UserBooks)
    .where(eq(UserBooks.userId, userId));

  // J'ajoute le filtre de statut si fourni
  if (status) {
    baseQuery.where(eq(UserBooks.status, status));
  }

  return await baseQuery;
}
```

=== ğŸ¯ Technology-Specific Conventions

==== Deno & TypeScript

**Imports and Exports**

```typescript
// âœ… Grouped and ordered imports
import { serve } from "https://deno.land/std@0.200.0/http/server.ts";
import { Hono } from "https://deno.land/x/hono@v3.12.0/mod.ts";

import { User, ReadingList } from "./models/index.ts";
import { validateJWT } from "./middleware/auth.ts";

// âœ… Named exports preferred
export { getUserLibrary, createBook };
export type { BookStatus, UserProfile };
```

**Explicit Deno Permissions**

```typescript
// deno.json - Je definis les permissions necessaires
{
  "tasks": {
    "dev": "deno run --allow-net --allow-read --allow-env src/main.ts"
  }
}
```

==== Drizzle ORM

**Table Schemas**

```typescript
// âœ… Table names in snake_case (PostgreSQL convention)
export const User = pgTable('users', {
  id: serial('id').primaryKey(),
  firstName: varchar('first_name', { length: 100 }).notNull(),
  lastName: varchar('last_name', { length: 100 }).notNull(),
  createdAt: timestamp('created_at').defaultNow(),
});

// âœ… Relations with explicit names
export const UserRelations = relations(User, ({ many }) => ({
  libraries: many(Library),
  readingLists: many(ReadingList),
}));
```

**Drizzle Queries**

```typescript
// âœ… Readable queries with explicit aliases
const userWithBooks = await db
  .select({
    userId: User.id,
    userName: User.firstName,
    bookTitle: Book.title,
    readingStatus: UserBooks.status,
  })
  .from(User)
  .leftJoin(UserBooks, eq(User.id, UserBooks.userId))
  .leftJoin(Book, eq(UserBooks.bookId, Book.id))
  .where(eq(User.id, userId));
```

==== Hono Framework

**Routes and Middleware**

```typescript
// âœ… Logically grouped routes
const authRoutes = new Hono();

authRoutes.post('/login', async (c) => {
  // Je recupere les donnees de connexion
  const { email, password } = await c.req.json();

  // Je valide les donnees avec le schema
  const validatedData = loginSchema.parse({ email, password });

  // Je continue le processus d'authentification...
});

// âœ… Middleware with explicit names
app.use('/api/*', jwtAuthMiddleware);
app.use('/api/admin/*', adminOnlyMiddleware);
```

=== ğŸ”’ Security Conventions

==== Secret Management

```typescript
// âœ… Environment variables in UPPER_SNAKE_CASE
const JWT_SECRET = Deno.env.get('JWT_SECRET');
const DATABASE_URL = Deno.env.get('DATABASE_URL');

// âŒ Never hardcode secrets
const jwtSecret = 'my-super-secure-secret'; // FORBIDDEN
```

==== Data Validation

```typescript
// âœ… Always validate user input
app.post('/api/users', async (c) => {
  try {
    // Je recupere et valide les donnees
    const rawData = await c.req.json();
    const validatedUser = createUserSchema.parse(rawData);

    // Je continue le traitement...
  } catch (error) {
    // Je log l'erreur technique en anglais
    console.error('User validation failed:', error);

    // Je retourne une erreur utilisateur en franÃ§ais
    return c.json({ error: 'Donnees utilisateur invalides' }, 400);
  }
});
```

=== ğŸ“ Documentation Conventions

==== README Files

```markdown
# Module Name

## Description
Je decris brievement le role du module sans accents.

## Installation
\`\`\`bash
deno install --allow-net module.ts
\`\`\`

## Usage
\`\`\`typescript
// J'importe le module
import { functionName } from "./module.ts";

// Je l'utilise dans mon code
const result = functionName();
\`\`\`
```

==== Git Commit Messages

**Format: `type(scope): description in English`**

```bash
# âœ… English commits, concise
git commit -m "feat(auth): add JWT stateless authentication"
git commit -m "fix(db): resolve user query performance issue"
git commit -m "docs(api): update endpoint specifications"

# âŒ French commits or with accents
git commit -m "ajout authentification JWT"
git commit -m "correction problÃ¨me performance"
```

=== ğŸ§ª Testing Conventions

**Explicit test names**

```typescript
// âœ… English tests with clear description
Deno.test("getUserLibrary should return user books with correct status", async () => {
  // J'arrange les donnees de test
  const userId = 1;
  const expectedStatus = 'read';

  // J'execute la fonction testee
  const result = await getUserLibrary(userId, expectedStatus);

  // Je verifie le resultat
  assertEquals(result.length, 3);
  assertTrue(result.every(book => book.status === expectedStatus));
});
```

---

ğŸ“ *Conventions d'Ã©quipe BlaBlaBook V2 ! Team conventions for BlaBlaBook V2!*