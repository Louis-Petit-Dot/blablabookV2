= BlaBlaBook V2 - Technical Architecture / Architecture Technique
:toc: left
:toclevels: 3
:sectanchors:
:icons: font
:version: 2.0
:date: {docdate}

// Navigation inter-documents
link:../README.adoc[üìö Documentation Hub] |
link:business-requirements.adoc[üìã Business] |
link:api-specifications.adoc[üõ£Ô∏è API] |
link:risk-analysis.adoc[‚ö†Ô∏è Risks]

// Navigation langues
<<section-fr,üá´üá∑ Version Fran√ßaise>> | <<section-en,üá¨üáßüá∫üá∏ English Version>>

---

[[section-fr]]
== üá´üá∑ Architecture Technique

<<section-en,üá¨üáßüá∫üá∏ Switch to English>> | üá´üá∑ *Fran√ßais*

=== üé® Branding & Identit√© Visuelle

==== Baseline de l'Application

**Baseline principale :**
> _"Des mots qui r√©sonnent, des livres qui rassemblent, des histoires qui passionnent"_

**Justification :**
* **Rythme ternaire** : Structure en 3 parties qui facilite la m√©morisation
* **Allit√©ration** : R√©p√©tition des sons "r" (r√©sonnent, rassemblent) qui cr√©e une musicalit√©
* **√âmotionnel** : Vocabulaire √©vocateur qui touche les lecteurs passionn√©s
* **Communautaire** : Met l'accent sur le partage et le rassemblement
* **Identit√© forte** : Se d√©marque des plateformes de lecture classiques

**Alternatives consid√©r√©es :**
* "Le sens des mots, le recueil des livres, la passion de la lecture" (plus descriptif, moins impactant)
* "Partagez vos lectures, d√©couvrez des passions" (trop direct, manque de po√©sie)
* "Lire, partager, d√©couvrir ensemble" (trop minimaliste)

==== Positionnement

BlaBlaBook V2 se positionne comme **une biblioth√®que sociale et communautaire** qui permet aux lecteurs de :
* Organiser et g√©rer leurs collections personnelles
* Partager leurs avis et recommandations
* D√©couvrir de nouveaux livres √† travers les passions des autres
* Cr√©er des liens autour de la lecture

**Diff√©renciation concurrentielle :**
* **vs Goodreads** : Interface moderne, RGPD-compliant, sans publicit√©
* **vs Babelio** : UX simplifi√©e, accessibilit√© native, gestion spoilers avanc√©e
* **vs Booknode** : Architecture technique moderne, performances optimales

=== üèóÔ∏è Choix et Justification de l'Architecture

Nous avons opt√© pour une **architecture client-serveur moderne** bas√©e sur les technologies les plus r√©centes pour garantir performance, s√©curit√© et maintenabilit√©. Cette approche V2 consiste en une API REST d√©velopp√©e avec **Deno 2.5.2 et Hono**, qui communique avec une Single Page Application (SPA) via des requ√™tes HTTP s√©curis√©es.

Le backend, orchestr√© avec **Drizzle 0.38.0** pour la gestion de la base de donn√©es PostgreSQL, expose des endpoints REST pour toutes les fonctionnalit√©s m√©tier : gestion des utilisateurs, biblioth√®ques personnelles, listes de lecture et avis.

**Avantages de cette architecture V2 :**
* **Performance native** : Deno runtime moderne avec support TypeScript natif
* **S√©curit√© by design** : Permissions granulaires Deno + validation Drizzle-Zod int√©gr√©e
* **Simplicit√© infrastructure** : 3 services Docker au lieu de 4 (suppression Redis)
* **Developer Experience** : TypeScript end-to-end avec types automatiques

=== üöÄ Stack Technique V2

[cols="2,2,3"]
|===
|Composant |V1 (Ancien) |V2 (Nouveau)

|*Backend Runtime*
|Node.js/Express/Sequelize
|**Deno 2.5.2 + Hono + Drizzle 0.38.0**

|*Frontend Build*
|Create React App/Webpack
|**Vite 6.3.6 + React 19.1.1 + TypeScript**

|*State Management*
|Redux/Context API
|**Zustand + Axios**

|*Styling*
|CSS-in-JS/Styled Components
|**SCSS + Radix UI**

|*Authentification*
|Sessions Redis + CSRF
|**JWT stateless + s√©curit√© OWASP**

|*Validation*
|Zod externe
|**Drizzle-Zod int√©gr√©**

|*Accessibilit√©*
|Manuellement impl√©ment√©e
|**Radix UI WCAG 2.1 AA natif**

|*Infrastructure*
|4 services Docker (+ Redis)
|**3 services Docker (- Redis)**
|===

==== BackEnd V2 üíª

**RunTime & Framework :**

* **Deno 2.5.2** : Runtime moderne JavaScript/TypeScript avec s√©curit√© int√©gr√©e
* **Hono** : Micro-framework web ultra-rapide et minimaliste
* **TypeScript** : Langage typ√© natif avec Deno (pas de compilation externe)

_Justifications :_
- **Performance native** : Runtime optimis√©, 4x plus rapide que Node.js
- **S√©curit√© by design** : Permissions granulaires, pas d'acc√®s filesystem par d√©faut
- **Developer Experience** : TypeScript natif, pas de configuration
- **√âcosyst√®me moderne** : Import maps, web standards, API compatibles

**üì¶ Note sur JSR (JavaScript Registry) :**

Hono est import√© via `jsr:@hono/hono` sans version sp√©cifique, contrairement aux packages npm comme `npm:drizzle-orm@^0.38.0`. Cette approche utilise le nouveau registre **JSR** (jsr.io) cr√©√© par l'√©quipe Deno en 2024.

**Diff√©rences npm vs JSR :**

[cols="2,2,2"]
|===
|Aspect |npm |JSR

|**Syntaxe**
|`npm:package@^1.0.0`
|`jsr:@scope/package`

|**TypeScript**
|Fichiers `.d.ts` s√©par√©s
|Types natifs inclus

|**R√©solution**
|node_modules
|Cache Deno global

|**Version**
|Toujours explicite
|Derni√®re stable par d√©faut
|===

**Pourquoi pas de version pour Hono ?**

Quand on √©crit `jsr:@hono/hono` sans version, Deno utilise automatiquement la **derni√®re version stable** du registre JSR (actuellement 4.9.8). Cette approche est courante avec JSR car :

* **TypeScript natif** : Hono est √©crit en TypeScript pur, pas besoin de `@types/hono`
* **Framework l√©ger** : Compatible Deno, Node.js, Bun, Cloudflare Workers
* **Cache global** : R√©solution instantan√©e via `~/.cache/deno/`
* **Audit automatique** : JSR v√©rifie les packages et leurs signatures
* **Documentation int√©gr√©e** : Preview du code sur https://jsr.io/@hono/hono

Pour fixer la version en production (recommand√©) :
```json
"hono": "jsr:@hono/hono@^4.9.8"
```

**Infrastructure & D√©ploiement :**

* **Docker** : Containerisation simplifi√©e (3 services au lieu de 4)
* **Nginx** : Reverse proxy et SSL termination
* **Docker Compose** : Orchestration multi-conteneurs optimis√©e

_Justifications :_
- **Architecture simplifi√©e** : App Deno + PostgreSQL + Nginx (suppression Redis)
- **Performance** : Moins de services = d√©marrage plus rapide
- **Maintenance** : Moins de d√©pendances √† g√©rer

==== Base de Donn√©es V2 üóÑÔ∏è

**Choix techniques :**

* **PostgreSQL** : SGBD relationnel avec support JSON natif (conteneur Docker)
* **Drizzle 0.38.0** : ORM moderne TypeScript-first avec validation int√©gr√©e
* **Drizzle-Zod** : Validation de sch√©mas automatique et type-safe

_Justifications PostgreSQL :_
- **ACID complet** : Transactions s√©curis√©es critiques
- **JSON natif** : Stockage m√©tadonn√©es Open Library
- **Full-text search** : Recherche optimis√©e livres
- **Extensions** : UUID, crypto, indexation avanc√©e

_Justifications Drizzle V2 :_
- **Performance** : Queries 2x plus rapides que Sequelize
- **TypeScript natif** : Types automatiques, inf√©rence compl√®te
- **Migrations** : Gestion sch√©ma robuste avec rollbacks
- **Zero runtime overhead** : Compilation temps de build

==== FrontEnd V2 üé®

**Framework & Build Tool :**

* **Vite 6.3.6** : Build tool moderne avec HMR ultra-rapide et support ESM natif
* **React 19.1.1** : Framework UI avec Concurrent Features et Server Components
* **TypeScript** : Langage typ√© end-to-end avec le backend Deno

_Justifications Vite :_
- **Performance de build** : 10-100x plus rapide que Webpack/CRA
- **Support ESM natif** : Compatibilit√© parfaite avec Deno backend
- **HMR instantan√©** : Hot Module Replacement en <50ms
- **Configuration simple** : Zero-config pour React + TypeScript
- **Optimisation automatique** : Tree-shaking et code splitting optimaux
- **√âcosyst√®me moderne** : Plugins Rollup compatibles, vite-imagetools pour optimisation images

**Routing & State Management :**

* **React Router 7.9.3** : Routing d√©claratif avec layouts et route protection
* **Zustand** : State management l√©ger et typ√©
* **Axios** : Client HTTP avec interceptors JWT et httpOnly cookies

_Justifications React Router 7.9.3 :_
- **Route Groups** : Organisation /public, /auth, /private, /admin pour RBAC
- **Layouts** : Header/footer diff√©renci√©s par zone d'authentification via `<Outlet>`
- **Loaders/Actions** : Chargement donn√©es avant rendu composants
- **Protected Routes** : Middleware de protection via composants HOC

_Justifications Zustand :_
- **Simplicit√©** : Pas de boilerplate Redux, API intuitive
- **Performance** : Re-renders optimis√©s, pas de providers
- **TypeScript natif** : Inf√©rence de types automatique
- **Bundle size** : 2KB vs 60KB pour Redux Toolkit

**Styling & UI Components :**

* **SCSS** : CSS avec variables, mixins et nesting
* **Radix UI** : Composants headless avec accessibilit√© WCAG 2.1
* **shadcn/ui** : Collection composants Radix pr√©-styl√©s et personnalisables
* **CSS Modules** : Encapsulation des styles par composant

_Justifications SCSS :_
- **Contr√¥le total** : Respect exact de la charte graphique d√©finie
- **Variables CSS** : Coh√©rence couleurs (#725B3A, #D0A868, #F2E5D0)
- **Mixins r√©utilisables** : DRY pour responsive design et animations
- **Performance** : Compilation optimis√©e sans runtime overhead
- **D√©monstration comp√©tences** : Exigence p√©dagogique projet scolaire

_Justifications Radix UI + shadcn/ui :_
- **Accessibilit√© native** : Conformit√© WCAG 2.1 niveau AA automatique
- **Headless architecture** : Logique sans style, personnalisation SCSS totale
- **Navigation clavier** : Focus management et ARIA attributes int√©gr√©s (~50h √©conomis√©es)
- **Composants complexes** : Dialog, Dropdown, Tabs avec √©tats g√©r√©s
- **Copy-paste approach** : Code source modifiable, pas de d√©pendance runtime lourde
- **TypeScript natif** : Props typ√©es automatiquement

**Architecture hybride :**
```
Landing page, Auth (login/register) ‚Üí SCSS pur (showcase acad√©mique)
Design system (_variables, _mixins, _animations) ‚Üí SCSS
Composants simples (BookCard, Sidebar) ‚Üí SCSS + CSS Modules
Composants accessibles complexes (Dialog, Dropdown) ‚Üí shadcn/ui + Radix + adaptations SCSS
```

**Charte Graphique Int√©gr√©e :**

```scss
// styles/variables.scss
$primary-color: #725B3A;    // Marron clair principal
$secondary-green: #D0A868;  // Beige dor√©
$secondary-beige: #F2E5D0;  // Beige clair
$gray-color: #999999;       // Gris
$cream-color: #FEFBF6;      // Blanc cass√©
```

**üîí S√©curit√© Frontend - Strat√©gie D√©fensive en Profondeur :**

**Architecture "Texte Brut Uniquement" :**

BlaBlaBook V2 utilise **exclusivement des √©l√©ments HTML natifs** (`<input>`, `<textarea>`) pour toute saisie de contenu utilisateur, en √©vitant d√©lib√©r√©ment les √©diteurs de texte riche (TinyMCE, Quill, Draft.js, Slate, Lexical).

**Exemple - Formulaire d'avis :**
```typescript
// ReviewForm.tsx - Lignes 74-82
<textarea
    id="review-comment"
    className={`${inputStyles.input} ${styles.textarea}`}
    value={comment}
    onChange={e => setComment(e.target.value)}
    rows={6}
    placeholder="Votre avis d√©taill√©..."
/>
// ‚úÖ <textarea> HTML natif - accepte UNIQUEMENT du texte brut
// ‚ùå PAS d'√©diteur riche - aucune injection HTML possible
```

**Double Protection XSS :**

1. **Couche Entr√©e** : `<textarea>` natif accepte **uniquement du texte brut** (pas de formatage HTML)
2. **Couche Sortie** : React JSX **√©chappe automatiquement le HTML** dans les `{expressions}`

```typescript
// Ce qu'un attaquant pourrait tenter d'injecter :
const maliciousInput = "<script>alert('XSS')</script>"

// Ce qui est stock√© en base de donn√©es :
"<script>alert('XSS')</script>"  // Cha√Æne de texte brut

// Ce que React affiche :
<p>{review.comment}</p>
// ‚Üí &lt;script&gt;alert('XSS')&lt;/script&gt;  ‚úÖ S√©curis√©
```

**Pourquoi Pas de Biblioth√®que DOMPurify ?**

- **Auto-√©chappement React JSX** : Protection XSS int√©gr√©e pour toutes les interpolations `{variable}`
- **Pas de dangerouslySetInnerHTML** : Jamais utilis√© dans toute la codebase (v√©rifi√©)
- **DOMPurify n√©cessaire uniquement** : Si rendu de contenu HTML riche (ce que nous ne faisons pas)
- **Surface d'attaque r√©duite** : Pas de vuln√©rabilit√©s CVE dans les biblioth√®ques d'√©diteur externes
- **Comportement pr√©visible** : Le HTML est toujours √©chapp√©, sans exceptions

**Avantages de la Strat√©gie "Texte Brut" :**

* **Surface d'attaque minimale** : `<textarea>` ne peut pas injecter `<script>`, `<iframe>`, ou gestionnaires d'√©v√©nements
* **Pas de d√©pendances externes** : Pas de vuln√©rabilit√©s CVE de biblioth√®ques d'√©diteur
* **Meilleures performances** : Pas de surcharge JavaScript WYSIWYG
* **UX coh√©rente** : Tout le contenu utilisateur rendu uniform√©ment
* **Mod√©ration facilit√©e** : Texte brut plus facile √† scanner pour contenu inappropri√©

Cette d√©cision architecturale suit le **principe du moindre privil√®ge** pour les capacit√©s de saisie utilisateur.

=== üîê Authentification JWT httpOnly Cookie

==== Architecture S√©curit√© V2 (Simplifi√©e)

**Flow JWT simplifi√© :**
```
1. Login ‚Üí JWT stock√© en httpOnly cookie (8h expiration)
2. Requ√™tes ‚Üí Cookie envoy√© automatiquement par navigateur
3. Expiration ‚Üí Re-login requis apr√®s 8h (pas de refresh token)
4. Logout ‚Üí Cookie cleared avec Max-Age=0
```

**Choix architecture :**
* **JWT simple** : Access token unique de 8h (pas de refresh token)
* **httpOnly cookie** : Protection XSS, JavaScript ne peut pas lire le token
* **SameSite=Strict** : Protection CSRF automatique
* **Max-Age=28800** : 8 heures = dur√©e session travail compl√®te
* **Secure flag** : HTTPS obligatoire en production

**Justifications JWT simple 8h :**
- **S√©curit√©/UX √©quilibr√©e** : Session compl√®te sans re-login constant
- **Complexit√© r√©duite** : Pas de table refresh_tokens, pas de rotation
- **Stateless maintenu** : Pas de Redis requis
- **MVP optimal** : Impl√©mentation rapide, s√©curit√© suffisante

**Claims JWT s√©curis√©s :**
* `id`, `email`, `username`, `iat`, `exp`
* Signature HMAC-256 avec JWT_SECRET
* Payload minimal pour r√©duire taille cookies

**Protections XSS/CSRF :**
* **httpOnly** : JavaScript ne peut pas acc√©der au token (protection XSS)
* **SameSite=Strict** : Cookie non envoy√© sur requ√™tes cross-origin (protection CSRF)
* **Secure flag** : Cookie uniquement sur HTTPS en production
* **CORS credentials** : `Access-Control-Allow-Credentials: true` configur√©
* **CSRF Token** : Double protection avec endpoint `/api/csrf-token`

==== Gestion des Avis et Spoilers

**Logique de protection par d√©faut :**
* **Cr√©ation d'avis** : `is_public: false, is_spoiler: false` (respect vie priv√©e)
* **Affichage lecteur** : Spoilers flout√©s CSS par d√©faut (protection spoiler)
* **Toggle global** : Bouton "Afficher/Masquer spoilers" sur interface
* **Consentement RGPD** : Cases √† cocher explicites pour publication

**Architecture Spoiler Management :**
```
Frontend:
- CSS blur filter par d√©faut sur .spoiler-content
- Toggle bouton: .show-spoilers active/inactive
- √âtat global: showSpoilers (true/false)

Backend:
- Endpoint GET /reviews avec param ?show_spoilers=true
- Validation permissions utilisateur avant affichage
- Metadata spoiler dans JSON: { is_spoiler: boolean }
```

**Avantages approche CSS blur :**
* **UX intuitive** : Syst√®me Discord-like familier
* **Performance** : Pas de parsing c√¥t√© serveur
* **Flexibilit√©** : Toggle instantan√© sans rechargement
* **S√©curit√©** : Donn√©es spoiler non envoy√©es si show_spoilers=false

==== Conformit√© OWASP Top 10

[cols="2,3"]
|===
|Vuln√©rabilit√© |Protection V2

|**A01 - Broken Access Control**
|Claims r√¥les/permissions dans JWT + validation middleware

|**A02 - Cryptographic Failures**
|Argon2 pour mots de passe + HMAC-256 pour JWT

|**A03 - Injection**
|Drizzle ORM + validation Drizzle-Zod sur toutes entr√©es

|**A05 - Security Misconfiguration**
|Headers Helmet + HTTPS forc√© + permissions Deno

|**A07 - Authentication Failures**
|Rate limiting Deno + rotation tokens + force logout
|===

=== üõ†Ô∏è Outils de D√©veloppement

**Validation & S√©curit√© :**
* **Drizzle-Zod** : Validation de sch√©mas int√©gr√©e avec typage automatique
* **Helmet** : Headers de s√©curit√© HTTP (CSP, HSTS, X-Frame-Options)
* **CORS** : Configuration Cross-Origin via middleware Hono
* **SSL/TLS** : HTTPS obligatoire en production via Nginx

**Tests & Qualit√© :**
* **Deno Test** : Framework de tests natif int√©gr√©
* **Deno Lint** : Linter TypeScript natif
* **Deno Format** : Formatage code automatique

=== ‚ôø Accessibilit√© Web (WCAG 2.1)

**Conformit√© niveau AA obligatoire :**

BlaBlaBook V2 respecte les **Web Content Accessibility Guidelines (WCAG) 2.1 niveau AA** pour garantir l'accessibilit√© √† tous les utilisateurs, y compris les personnes en situation de handicap.

**Principes WCAG impl√©ment√©s :**

[cols="2,3"]
|===
|Principe |Impl√©mentation V2

|**1. Perceptible**
|Contrastes couleurs ‚â•4.5:1, textes alternatifs images, sous-titres vid√©os

|**2. Utilisable**
|Navigation clavier compl√®te, pas de clignotements, temps de session √©tendus

|**3. Compr√©hensible**
|Langue HTML d√©clar√©e, labels formulaires explicites, messages d'erreur clairs

|**4. Robuste**
|HTML s√©mantique valide, compatibilit√© technologies d'assistance
|===

**Outils et techniques :**

* **HTML s√©mantique** : Utilisation correcte des balises `<main>`, `<nav>`, `<section>`, `<article>`
* **ARIA labels** : Attributs `aria-label`, `aria-describedby` pour √©l√©ments interactifs
* **Focus management** : Ordre de tabulation logique, indicateurs de focus visibles
* **Responsive design** : Zoom jusqu'√† 200% sans perte de fonctionnalit√©
* **Tests automatis√©s** : Integration axe-core dans les tests Deno pour validation continue

**Validation conformit√© :**

* **Tests manuels** : Navigation clavier, lecteurs d'√©cran (NVDA, JAWS)
* **Tests automatis√©s** : Lighthouse accessibility, axe-core dans CI/CD
* **Audit externe** : Validation par expert accessibilit√© avant mise en production

=== üê≥ Infrastructure Docker

**Architecture 3 services :**

```yaml
services:
  # Service 1: Application Deno
  blablabook-app:
    build: .
    ports: ["3000:3000"]
    depends_on: [postgres]

  # Service 2: Base de donn√©es
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: blablabook_v2

  # Service 3: Reverse Proxy
  nginx:
    image: nginx:alpine
    ports: ["80:80", "443:443"]
    depends_on: [blablabook-app]
```

**Simplifications V2 :**
* ‚ùå **Redis supprim√©** : JWT stateless √©limine le besoin de cache sessions
* ‚úÖ **3 conteneurs** au lieu de 4 : Architecture plus simple
* ‚úÖ **Moins de d√©pendances** : Maintenance r√©duite

---

[[section-en]]
== üá¨üáßüá∫üá∏ Technical Architecture

üá¨üáßüá∫üá∏ *English* | <<section-fr,üá´üá∑ Passer au Fran√ßais>>

=== üé® Branding & Visual Identity

==== Application Baseline

**Main baseline:**
> _"Words that resonate, books that bring together, stories that captivate"_

**Justification:**
* **Ternary rhythm** : 3-part structure that facilitates memorization
* **Alliteration** : Repetition of "r" sounds creates musicality
* **Emotional** : Evocative vocabulary that touches passionate readers
* **Community-focused** : Emphasizes sharing and bringing people together
* **Strong identity** : Stands out from classic reading platforms

**Considered alternatives:**
* "The meaning of words, the collection of books, the passion for reading" (more descriptive, less impactful)
* "Share your readings, discover passions" (too direct, lacks poetry)
* "Read, share, discover together" (too minimalist)

==== Positioning

BlaBlaBook V2 positions itself as **a social and community library** that allows readers to:
* Organize and manage their personal collections
* Share their reviews and recommendations
* Discover new books through others' passions
* Create connections around reading

**Competitive differentiation:**
* **vs Goodreads** : Modern interface, GDPR-compliant, ad-free
* **vs Babelio** : Simplified UX, native accessibility, advanced spoiler management
* **vs Booknode** : Modern technical architecture, optimal performance

=== üèóÔ∏è Architecture Choice & Justification

We chose a **modern client-server architecture** based on the latest technologies to guarantee performance, security, and maintainability. This V2 approach consists of a REST API developed with **Deno 2.5.2 and Hono**, communicating with a Single Page Application (SPA) via secure HTTP requests.

The backend, orchestrated with **Drizzle 0.38.0** for PostgreSQL database management, exposes REST endpoints for all business functionalities: user management, personal libraries, reading lists, and reviews.

**V2 Architecture Benefits:**
* **Native performance** : Modern Deno runtime with native TypeScript support
* **Security by design** : Granular Deno permissions + integrated Drizzle-Zod validation
* **Infrastructure simplicity** : 3 Docker services instead of 4 (Redis removal)
* **Developer Experience** : End-to-end TypeScript with automatic types

=== üöÄ V2 Technical Stack

[cols="2,2,3"]
|===
|Component |V1 (Legacy) |V2 (New)

|*Backend Runtime*
|Node.js/Express/Sequelize
|**Deno 2.5.2 + Hono + Drizzle 0.38.0**

|*Frontend Build*
|Create React App/Webpack
|**Vite 6.3.6 + React 19.1.1 + TypeScript**

|*State Management*
|Redux/Context API
|**Zustand + Axios**

|*Styling*
|CSS-in-JS/Styled Components
|**SCSS + Radix UI**

|*Authentication*
|Redis Sessions + CSRF
|**JWT stateless + OWASP security**

|*Validation*
|External Zod
|**Drizzle-Zod integrated**

|*Accessibility*
|Manually implemented
|**Radix UI WCAG 2.1 AA native**

|*Infrastructure*
|4 Docker services (+ Redis)
|**3 Docker services (- Redis)**
|===

==== BackEnd V2 üíª

**Runtime & Framework:**

* **Deno 2.5.2** : Modern JavaScript/TypeScript runtime with integrated security
* **Hono** : Ultra-fast and minimalist web micro-framework
* **TypeScript** : Native typed language with Deno (no external compilation)

_Justifications:_
- **Native performance** : Optimized runtime, 4x faster than Node.js
- **Security by design** : Granular permissions, no filesystem access by default
- **Developer Experience** : Native TypeScript, no configuration needed
- **Modern ecosystem** : Import maps, web standards, compatible APIs

**üì¶ Note on JSR (JavaScript Registry):**

Hono is imported via `jsr:@hono/hono` without a specific version, unlike npm packages like `npm:drizzle-orm@^0.38.0`. This approach uses the new **JSR** registry (jsr.io) created by the Deno team in 2024.

**npm vs JSR differences:**

[cols="2,2,2"]
|===
|Aspect |npm |JSR

|**Syntax**
|`npm:package@^1.0.0`
|`jsr:@scope/package`

|**TypeScript**
|Separate `.d.ts` files
|Native types included

|**Resolution**
|node_modules
|Deno global cache

|**Version**
|Always explicit
|Latest stable by default
|===

**Why no version for Hono?**

When writing `jsr:@hono/hono` without a version, Deno automatically uses the **latest stable version** from the JSR registry (currently 4.9.8). This approach is common with JSR because:

* **Native TypeScript** : Hono is written in pure TypeScript, no need for `@types/hono`
* **Lightweight framework** : Compatible with Deno, Node.js, Bun, Cloudflare Workers
* **Global cache** : Instant resolution via `~/.cache/deno/`
* **Automatic audit** : JSR verifies packages and their signatures
* **Integrated documentation** : Code preview at https://jsr.io/@hono/hono

To pin the version in production (recommended):
```json
"hono": "jsr:@hono/hono@^4.9.8"
```

**Infrastructure & Deployment:**

* **Docker** : Simplified containerization (3 services instead of 4)
* **Nginx** : Reverse proxy and SSL termination
* **Docker Compose** : Optimized multi-container orchestration

_Justifications:_
- **Simplified architecture** : Deno App + PostgreSQL + Nginx (Redis removal)
- **Performance** : Fewer services = faster startup
- **Maintenance** : Fewer dependencies to manage

==== Database V2 üóÑÔ∏è

**Technical choices:**

* **PostgreSQL** : Relational DBMS with native JSON support (Docker container)
* **Drizzle 0.38.0** : Modern TypeScript-first ORM with integrated validation
* **Drizzle-Zod** : Automatic and type-safe schema validation

_PostgreSQL Justifications:_
- **Complete ACID** : Critical secure transactions
- **Native JSON** : Open Library metadata storage
- **Full-text search** : Optimized book search
- **Extensions** : UUID, crypto, advanced indexing

_Drizzle V2 Justifications:_
- **Performance** : Queries 2x faster than Sequelize
- **Native TypeScript** : Automatic types, complete inference
- **Migrations** : Robust schema management with rollbacks
- **Zero runtime overhead** : Build-time compilation

==== FrontEnd V2 üé®

**Framework & Build Tool:**

* **Vite 6.3.6** : Modern build tool with ultra-fast HMR and native ESM support
* **React 19.1.1** : UI framework with Concurrent Features and Server Components
* **TypeScript** : End-to-end typed language with Deno backend

_Vite Justifications:_
- **Build performance** : 10-100x faster than Webpack/CRA
- **Native ESM support** : Perfect compatibility with Deno backend
- **Instant HMR** : Hot Module Replacement in <50ms
- **Simple configuration** : Zero-config for React + TypeScript
- **Automatic optimization** : Optimal tree-shaking and code splitting
- **Modern ecosystem** : Rollup plugins compatible, vite-imagetools for image optimization

**Routing & State Management:**

* **React Router 7.9.3** : Declarative routing with layouts and route protection
* **Zustand** : Lightweight and typed state management
* **Axios** : HTTP client with JWT interceptors and httpOnly cookies

_React Router 7.9.3 Justifications:_
- **Route Groups** : /public, /auth, /private, /admin organization for RBAC
- **Layouts** : Differentiated header/footer by authentication zone via `<Outlet>`
- **Loaders/Actions** : Data loading before component render
- **Protected Routes** : Protection middleware via HOC components

_Zustand Justifications:_
- **Simplicity** : No Redux boilerplate, intuitive API
- **Performance** : Optimized re-renders, no providers
- **Native TypeScript** : Automatic type inference
- **Bundle size** : 2KB vs 60KB for Redux Toolkit

**Styling & UI Components:**

* **SCSS** : CSS with variables, mixins and nesting
* **Radix UI** : Headless components with WCAG 2.1 accessibility
* **shadcn/ui** : Pre-styled and customizable Radix components collection
* **CSS Modules** : Component-scoped style encapsulation

_SCSS Justifications:_
- **Total control** : Exact respect of defined graphic charter
- **CSS variables** : Color consistency (#725B3A, #D0A868, #F2E5D0)
- **Reusable mixins** : DRY for responsive design and animations
- **Performance** : Optimized compilation without runtime overhead
- **Skills demonstration** : Academic project pedagogical requirement

_Radix UI + shadcn/ui Justifications:_
- **Native accessibility** : Automatic WCAG 2.1 level AA compliance
- **Headless architecture** : Logic without style, total SCSS customization
- **Keyboard navigation** : Integrated focus management and ARIA attributes (~50h saved)
- **Complex components** : Dialog, Dropdown, Tabs with managed states
- **Copy-paste approach** : Modifiable source code, no heavy runtime dependency
- **Native TypeScript** : Automatically typed props

**Hybrid architecture:**
```
Landing page, Auth (login/register) ‚Üí Pure SCSS (academic showcase)
Design system (_variables, _mixins, _animations) ‚Üí SCSS
Simple components (BookCard, Sidebar) ‚Üí SCSS + CSS Modules
Complex accessible components (Dialog, Dropdown) ‚Üí shadcn/ui + Radix + SCSS adaptations
```

**Integrated Graphic Charter:**

```scss
// styles/variables.scss
$primary-color:  #725B3A;    // Primary light brown
$secondary-black: #D0A868 // Golden beige
econdary-beige: #F2E5D0;  // Light beige
$gray-color: #999999;       // Gray
$cream-color: #FEFBF6;      // Off-white
```

**üîí Frontend Security - Defense in Depth Strategy:**

**Plain Text Only Architecture:**

BlaBlaBook V2 uses **exclusively native HTML elements** (`<input>`, `<textarea>`) for all user content input, deliberately avoiding rich text editors (TinyMCE, Quill, Draft.js, Slate, Lexical).

**Example - Review Form:**
```typescript
// ReviewForm.tsx - Lines 74-82
<textarea
    id="review-comment"
    className={`${inputStyles.input} ${styles.textarea}`}
    value={comment}
    onChange={e => setComment(e.target.value)}
    rows={6}
    placeholder="Votre avis d√©taill√©..."
/>
// ‚úÖ Native HTML <textarea> - accepts ONLY plain text
// ‚ùå NO rich text editor - no HTML injection possible
```

**Double XSS Protection:**

1. **Input Layer** : Native `<textarea>` accepts **only plain text** (no HTML formatting)
2. **Output Layer** : React JSX **automatically escapes HTML** in `{expressions}`

```typescript
// What an attacker might try to inject:
const maliciousInput = "<script>alert('XSS')</script>"

// What is stored in database:
"<script>alert('XSS')</script>"  // Plain text string

// What React displays:
<p>{review.comment}</p>
// ‚Üí &lt;script&gt;alert('XSS')&lt;/script&gt;  ‚úÖ Safe
```

**Why No DOMPurify Library?**

- **React JSX auto-escaping** : Built-in XSS protection for all `{variable}` interpolations
- **No dangerouslySetInnerHTML** : Never used in entire codebase (verified)
- **DOMPurify only needed** : If rendering rich HTML content (which we don't)
- **Smaller attack surface** : No CVE vulnerabilities from external editor libraries
- **Predictable behavior** : HTML is always escaped, no exceptions

**Benefits of Plain Text Strategy:**

* **Minimal attack surface** : `<textarea>` cannot inject `<script>`, `<iframe>`, or event handlers
* **No external dependencies** : No CVE vulnerabilities from editor libraries
* **Better performance** : No WYSIWYG JavaScript overhead
* **Consistent UX** : All user content rendered uniformly
* **Easier moderation** : Plain text easier to scan for inappropriate content

This architectural decision follows the **principle of least privilege** for user input capabilities.

=== üîê JWT httpOnly Cookie Authentication

==== V2 Security Architecture (Simplified)

**Simplified JWT Flow:**
```
1. Login ‚Üí JWT stored in httpOnly cookie (8h expiration)
2. Requests ‚Üí Cookie automatically sent by browser
3. Expiration ‚Üí Re-login required after 8h (no refresh token)
4. Logout ‚Üí Cookie cleared with Max-Age=0
```

**Architecture choices:**
* **Simple JWT** : Single 8h access token (no refresh token)
* **httpOnly cookie** : XSS protection, JavaScript cannot read token
* **SameSite=Strict** : Automatic CSRF protection
* **Max-Age=28800** : 8 hours = complete work session duration
* **Secure flag** : HTTPS mandatory in production

**Simple 8h JWT Justifications:**
- **Balanced security/UX** : Complete session without constant re-login
- **Reduced complexity** : No refresh_tokens table, no rotation
- **Stateless maintained** : No Redis required
- **Optimal MVP** : Fast implementation, sufficient security

**Secure JWT Claims:**
* `id`, `email`, `username`, `iat`, `exp`
* HMAC-256 signature with JWT_SECRET
* Minimal payload to reduce cookie size

**XSS/CSRF Protections:**
* **httpOnly** : JavaScript cannot access token (XSS protection)
* **SameSite=Strict** : Cookie not sent on cross-origin requests (CSRF protection)
* **Secure flag** : Cookie only on HTTPS in production
* **CORS credentials** : `Access-Control-Allow-Credentials: true` configured
* **CSRF Token** : Double protection with `/api/csrf-token` endpoint

==== Review and Spoiler Management

**Default protection logic:**
* **Review creation** : `is_public: false, is_spoiler: false` (privacy respect)
* **Reader display** : Spoilers CSS-blurred by default (spoiler protection)
* **Global toggle** : "Show/Hide spoilers" button on interface
* **GDPR consent** : Explicit checkboxes for publication

**Spoiler Management Architecture:**
```
Frontend:
- CSS blur filter by default on .spoiler-content
- Toggle button: .show-spoilers active/inactive
- Global state: showSpoilers (true/false)

Backend:
- GET /reviews endpoint with ?show_spoilers=true param
- User permissions validation before display
- Spoiler metadata in JSON: { is_spoiler: boolean }
```

**CSS blur approach advantages:**
* **Intuitive UX** : Discord-like familiar system
* **Performance** : No server-side parsing
* **Flexibility** : Instant toggle without reload
* **Security** : Spoiler data not sent if show_spoilers=false

==== OWASP Top 10 Compliance

[cols="2,3"]
|===
|Vulnerability |V2 Protection

|**A01 - Broken Access Control**
|JWT roles/permissions claims + middleware validation

|**A02 - Cryptographic Failures**
|Argon2 for passwords + HMAC-256 for JWT

|**A03 - Injection**
|Drizzle ORM + Drizzle-Zod validation on all inputs

|**A05 - Security Misconfiguration**
|Helmet headers + forced HTTPS + Deno permissions

|**A07 - Authentication Failures**
|Deno rate limiting + token rotation + forced logout
|===

=== üõ†Ô∏è Development Tools

**Validation & Security:**
* **Drizzle-Zod** : Integrated schema validation with automatic typing
* **Helmet** : HTTP security headers (CSP, HSTS, X-Frame-Options)
* **CORS** : Cross-Origin configuration via Hono middleware
* **SSL/TLS** : HTTPS mandatory in production via Nginx

**Testing & Quality:**
* **Deno Test** : Integrated native test framework
* **Deno Lint** : Native TypeScript linter
* **Deno Format** : Automatic code formatting

=== ‚ôø Web Accessibility (WCAG 2.1)

**Mandatory AA level compliance:**

BlaBlaBook V2 complies with **Web Content Accessibility Guidelines (WCAG) 2.1 level AA** to ensure accessibility for all users, including people with disabilities.

**WCAG principles implemented:**

[cols="2,3"]
|===
|Principle |V2 Implementation

|**1. Perceivable**
|Color contrasts ‚â•4.5:1, image alt texts, video captions

|**2. Operable**
|Complete keyboard navigation, no flashing content, extended session times

|**3. Understandable**
|HTML language declared, explicit form labels, clear error messages

|**4. Robust**
|Valid semantic HTML, assistive technology compatibility
|===

**Tools and techniques:**

* **Semantic HTML** : Proper use of `<main>`, `<nav>`, `<section>`, `<article>` tags
* **ARIA labels** : `aria-label`, `aria-describedby` attributes for interactive elements
* **Focus management** : Logical tab order, visible focus indicators
* **Responsive design** : Zoom up to 200% without functionality loss
* **Automated testing** : axe-core integration in Deno tests for continuous validation

**Compliance validation:**

* **Manual testing** : Keyboard navigation, screen readers (NVDA, JAWS)
* **Automated testing** : Lighthouse accessibility, axe-core in CI/CD
* **External audit** : Accessibility expert validation before production

=== üê≥ Docker Infrastructure

**3-service architecture:**

```yaml
services:
  # Service 1: Deno Application
  blablabook-app:
    build: .
    ports: ["3000:3000"]
    depends_on: [postgres]

  # Service 2: Database
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: blablabook_v2

  # Service 3: Reverse Proxy
  nginx:
    image: nginx:alpine
    ports: ["80:80", "443:443"]
    depends_on: [blablabook-app]
```

**V2 Simplifications:**
* ‚ùå **Redis removed** : Stateless JWT eliminates session cache need
* ‚úÖ **3 containers** instead of 4 : Simpler architecture
* ‚úÖ **Fewer dependencies** : Reduced maintenance

---

*Document cr√©√© le {14/09/2025} - Version {V1} - Generated on {2025/09/14} - Version {V1}*