= React Router v7 - Explications
:toc:
:toc-title: Sommaire

== ğŸ“ Fichier : `src/router.tsx`

=== Code Complet

[source,typescript]
----
import { createBrowserRouter } from 'react-router-dom'

export const router = createBrowserRouter([
  {
    path: '/',
    element: <div>Public Layout (Ã  crÃ©er)</div>,
    children: [
      { index: true, element: <div>Home Page</div> },
      { path: 'login', element: <div>Login Page</div> },
      { path: 'register', element: <div>Register Page</div> },
    ],
  },
  {
    path: '/dashboard',
    element: <div>Dashboard Layout (Ã  crÃ©er)</div>,
    children: [
      { index: true, element: <div>Dashboard Page</div> },
    ],
  },
])
----

== ğŸ” Explications Ligne par Ligne

=== Ligne 1 : Import

[source,typescript]
----
import { createBrowserRouter } from 'react-router-dom'
----

**Import de la fonction `createBrowserRouter`** depuis React Router v7.

- C'est la nouvelle faÃ§on de crÃ©er un router (remplace l'ancien `<BrowserRouter>`)
- Cette fonction permet de dÃ©finir toutes les routes de maniÃ¨re dÃ©clarative
- Avantage : meilleure performance, data loading, error handling

---

=== Ligne 3 : Export du Router

[source,typescript]
----
export const router = createBrowserRouter([
----

**CrÃ©ation et export du router**.

- On l'exporte pour pouvoir l'importer dans `main.tsx`
- Le `[` dÃ©marre un tableau d'objets routes
- Chaque objet = une route avec ses enfants

---

=== Lignes 4-5 : Route Parent Publique

[source,typescript]
----
  {
    path: '/',
----

**PremiÃ¨re route** : `/` (racine du site).

- C'est le **parent** de toutes les routes publiques
- Toutes ses `children` partageront le mÃªme layout

---

=== Ligne 6 : Element du Layout

[source,typescript]
----
    element: <div>Public Layout (Ã  crÃ©er)</div>,
----

**Ã‰lÃ©ment React Ã  afficher** pour cette route.

- Pour l'instant c'est une `<div>` placeholder
- Plus tard ce sera `<PublicLayout />` qui contiendra :
  - Header commun (logo, nav, user menu)
  - Un `<Outlet />` oÃ¹ s'afficheront les enfants
  - Footer (optionnel)

---

=== Ligne 7 : Routes Enfants

[source,typescript]
----
    children: [
----

**Routes enfants** : toutes les pages qui seront **wrappÃ©es** par le layout parent.

- Ces enfants s'affichent dans un `<Outlet />` du parent
- Ils hÃ©ritent automatiquement du layout (Header commun)

---

=== Ligne 8 : Route Index (Home)

[source,typescript]
----
      { index: true, element: <div>Home Page</div> },
----

**Route par dÃ©faut du parent**.

- `index: true` signifie "quand on est exactement sur `/`, affiche cet Ã©lÃ©ment"
- Pas besoin de prÃ©ciser `path: '/'` car c'est implicite avec `index`
- Plus tard ce sera `<Home />` avec le Hero, FeaturedBooks, etc.

---

=== Ligne 9 : Route Login

[source,typescript]
----
      { path: 'login', element: <div>Login Page</div> },
----

**Route `/login`**.

- Le path est **relatif au parent**, donc `'/'` + `'login'` = `/login`
- Affiche la page Login (formulaire email/password, OAuth Google)
- HÃ©rite du PublicLayout (Header reste visible)

---

=== Ligne 10 : Route Register

[source,typescript]
----
      { path: 'register', element: <div>Register Page</div> },
----

**Route `/register`**.

- MÃªme principe que login
- Page d'inscription (multistep form : infos â†’ prÃ©fÃ©rences lectures)

---

=== Lignes 11-12 : Fermeture Routes Publiques

[source,typescript]
----
    ],
  },
----

**Fin des enfants** de la route `/`.

---

=== Lignes 13-14 : Route Parent Dashboard

[source,typescript]
----
  {
    path: '/dashboard',
----

**DeuxiÃ¨me route parent** : `/dashboard`.

- C'est la zone **authentifiÃ©e**
- Tous ses enfants nÃ©cessiteront d'Ãªtre connectÃ© (protected routes)

---

=== Ligne 15 : Layout Dashboard

[source,typescript]
----
    element: <div>Dashboard Layout (Ã  crÃ©er)</div>,
----

**Layout du dashboard**.

- Plus tard ce sera `<DashboardLayout />` avec :
  - Header (logo, nav, notifications, user menu)
  - Sidebar (menu navigation dashboard)
  - `<Outlet />` pour le contenu principal
  - Protected route (redirection si non authentifiÃ©)

---

=== Lignes 16-18 : Enfants Dashboard

[source,typescript]
----
    children: [
      { index: true, element: <div>Dashboard Page</div> },
    ],
----

**Route par dÃ©faut** : quand on est sur `/dashboard`, affiche cette page.

- `index: true` â†’ route exacte `/dashboard`
- Plus tard on ajoutera `/dashboard/library`, `/dashboard/lists`, etc.

---

=== Lignes 19-20 : Fermeture

[source,typescript]
----
  },
])
----

**Fin du tableau de routes**.

- Fermeture de `createBrowserRouter()`
- Le router est prÃªt Ã  Ãªtre utilisÃ© dans `main.tsx`

== ğŸ—ºï¸ Structure des Routes

=== Routes Actuelles

[source]
----
/                    â†’ Public Layout
â”œâ”€â”€ / (index)        â†’ Home Page
â”œâ”€â”€ /login           â†’ Login Page
â””â”€â”€ /register        â†’ Register Page

/dashboard           â†’ Dashboard Layout
â””â”€â”€ /dashboard (index) â†’ Dashboard Page
----

=== Routes Futures (Phase 2+)

[source]
----
/                    â†’ Public Layout
â”œâ”€â”€ / (index)        â†’ Home
â”œâ”€â”€ /login           â†’ Login
â”œâ”€â”€ /register        â†’ Register
â”œâ”€â”€ /books           â†’ Catalogue
â”œâ”€â”€ /books/:id       â†’ Book Detail
â”œâ”€â”€ /authors/:id     â†’ Author Page
â””â”€â”€ /about           â†’ About

/dashboard           â†’ Dashboard Layout (Protected)
â”œâ”€â”€ /dashboard (index)        â†’ Dashboard
â”œâ”€â”€ /dashboard/library        â†’ My Library
â”œâ”€â”€ /dashboard/lists          â†’ My Reading Lists
â”œâ”€â”€ /dashboard/lists/:id      â†’ List Detail
â”œâ”€â”€ /dashboard/reviews        â†’ My Reviews
â””â”€â”€ /dashboard/profile        â†’ Profile

/admin               â†’ Admin Layout (Protected + Role)
â”œâ”€â”€ /admin (index)            â†’ Admin Dashboard
â”œâ”€â”€ /admin/users              â†’ User Management
â”œâ”€â”€ /admin/roles              â†’ Role Management
â”œâ”€â”€ /admin/permissions        â†’ Permission Management
â””â”€â”€ /admin/moderation         â†’ Content Moderation
----

== ğŸ” Protected Routes (Ã  venir)

=== Principe

Les **protected routes** vÃ©rifient si l'utilisateur est authentifiÃ© avant d'afficher la page.

=== ImplÃ©mentation (Phase 2)

[source,typescript]
----
// components/ProtectedRoute.tsx
import { Navigate, Outlet } from 'react-router-dom'
import { useAuthStore } from '../store/authStore'

export function ProtectedRoute() {
  const { isAuthenticated } = useAuthStore()

  if (!isAuthenticated) {
    return <Navigate to="/login" replace />
  }

  return <Outlet />
}

// router.tsx
{
  path: '/dashboard',
  element: <ProtectedRoute />, // VÃ©rifie auth AVANT d'afficher le layout
  children: [
    {
      element: <DashboardLayout />, // Layout SI authentifiÃ©
      children: [
        { index: true, element: <Dashboard /> },
      ],
    },
  ],
}
----

=== Role-Based Access (Phase 7)

[source,typescript]
----
// components/RoleProtectedRoute.tsx
export function RoleProtectedRoute({ allowedRoles }: { allowedRoles: string[] }) {
  const { user } = useAuthStore()

  if (!user || !allowedRoles.includes(user.role)) {
    return <Navigate to="/dashboard" replace />
  }

  return <Outlet />
}

// router.tsx
{
  path: '/admin',
  element: <RoleProtectedRoute allowedRoles={['admin', 'moderator']} />,
  children: [
    // Admin routes...
  ],
}
----

== ğŸ§­ Navigation dans les Composants

=== Liens de Navigation

[source,typescript]
----
import { Link } from 'react-router-dom'

// Dans un composant
<Link to="/login">Se connecter</Link>
<Link to="/dashboard">Mon Dashboard</Link>
<Link to={`/books/${bookId}`}>Voir le livre</Link>
----

=== Navigation Programmatique

[source,typescript]
----
import { useNavigate } from 'react-router-dom'

function LoginForm() {
  const navigate = useNavigate()

  const handleLogin = async (data) => {
    await loginUser(data)
    navigate('/dashboard') // Redirection aprÃ¨s login
  }

  return <form onSubmit={handleLogin}>...</form>
}
----

=== RÃ©cupÃ©rer les Params d'URL

[source,typescript]
----
import { useParams } from 'react-router-dom'

function BookDetail() {
  const { id } = useParams() // /books/123 â†’ id = "123"

  // Fetch book avec l'id...
}
----

== ğŸ“‹ Prochaines Ã‰tapes

1. âœ… Router crÃ©Ã© avec placeholders `<div>`
2. â³ CrÃ©er les **Layouts** (PublicLayout, DashboardLayout)
3. â³ CrÃ©er les **Pages** (Home, Login, Register, Dashboard)
4. â³ Remplacer les `<div>` par les vrais imports dans `router.tsx`
5. â³ Ajouter **ProtectedRoute** pour zone authentifiÃ©e
6. â³ Ajouter **RoleProtectedRoute** pour admin

== ğŸ”— IntÃ©gration dans `main.tsx`

Une fois les layouts/pages crÃ©Ã©s, on intÃ©grera le router :

[source,typescript]
----
// main.tsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { RouterProvider } from 'react-router-dom'
import { router } from './router'
import './styles/global.scss'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <RouterProvider router={router} />
  </StrictMode>,
)
----

**Explications** :

- `RouterProvider` : Composant qui rend le router actif
- `router={router}` : On passe notre router crÃ©Ã© dans `router.tsx`
- Plus besoin de `<App />`, le router gÃ¨re tout
