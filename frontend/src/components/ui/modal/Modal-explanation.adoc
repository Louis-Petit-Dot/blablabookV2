= Composant Modal - Documentation compl√®te
:toc:
:toclevels: 3

== Vue d'ensemble

Le composant `Modal` est une bo√Æte de dialogue modale **WCAG 2.2 AA compliant** construite avec **Radix UI Dialog**. Elle g√®re automatiquement le focus, le pi√®ge clavier, la fermeture par Escape et le backdrop cliquable.

**Pourquoi Radix UI ?**

* ‚úÖ **Accessibilit√© native** : WCAG 2.2 AA out-of-the-box
* ‚úÖ **Focus management** : Pi√®ge de focus et restauration automatiques
* ‚úÖ **Portail DOM** : Rendu √† la racine du document pour √©viter les probl√®mes de z-index
* ‚úÖ **API simple** : Moins de code, plus fiable
* ‚úÖ **Maintenabilit√©** : Test√© et maintenu par l'√©quipe Radix

**Strat√©gie du projet :**

* **Composants simples** (Button, Input, Card) ‚Üí SCSS custom pour apprentissage
* **Composants complexes** (Modal, Dropdown, Tooltip) ‚Üí Radix UI pour fiabilit√©

---

== Modal.tsx - Explication ligne par ligne

=== Imports (lignes 1-2)

[source,typescript]
----
import * as Dialog from '@radix-ui/react-dialog'
import styles from './Modal.module.scss'
----

**Ligne 1 - Import Radix Dialog :**

* `import * as Dialog` : Importe tous les composants Radix Dialog dans un namespace.
* Composants disponibles :
  - `Dialog.Root` : Container principal qui g√®re l'√©tat
  - `Dialog.Portal` : Portail pour rendre √† la racine du DOM
  - `Dialog.Overlay` : Backdrop semi-transparent
  - `Dialog.Content` : Contenu de la modale
  - `Dialog.Title` : Titre accessible
  - `Dialog.Description` : Description accessible
  - `Dialog.Close` : Bouton de fermeture

**Ligne 2 - Import CSS Module :**

* `styles` : Nos styles SCSS personnalis√©s appliqu√©s aux composants Radix

---

=== Interface TypeScript (lignes 4-11)

[source,typescript]
----
interface ModalProps {
    isOpen: boolean
    onClose: () => void
    title?: string
    description?: string
    children: React.ReactNode
    className?: string
}
----

**Props du composant :**

* `isOpen: boolean` : √âtat d'ouverture de la modale. **Obligatoire**.

* `onClose: () => void` : Callback appel√©e lors de la fermeture. **Obligatoire**.

* `title?: string` : Titre de la modale. Optionnel mais **recommand√© pour WCAG**.

* `description?: string` : Description sous le titre. Optionnel.

* `children: React.ReactNode` : Contenu de la modale. **Obligatoire**.

* `className?: string` : Classes CSS additionnelles pour le Dialog.Content.

**Simplification vs version custom :**

* ‚ùå Supprim√© : `closeOnBackdropClick`, `closeOnEscape` ‚Üí Radix les g√®re automatiquement
* ‚ùå Supprim√© : `extends InputHTMLAttributes` ‚Üí Pas besoin avec Radix
* ‚úÖ Ajout√© : `className` pour flexibilit√© de style

---

=== Composant principal (lignes 13-46)

[source,typescript]
----
export function Modal({
    isOpen,
    onClose,
    title,
    description,
    children,
    className
}: ModalProps) {
----

**Ligne 13 - Export de fonction :**

* `export function Modal` : Fonction component classique (pas besoin de forwardRef avec Radix)

* Destructuration directe des props pour clart√©

---

=== Dialog.Root - Gestion de l'√©tat (ligne 21-22)

[source,typescript]
----
<Dialog.Root open={isOpen} onOpenChange={(open) => !open && onClose()}>
----

**Dialog.Root :**

* `open={isOpen}` : √âtat contr√¥l√© de la modale (controlled component)

* `onOpenChange={(open) => !open && onClose()}` :
  - Callback appel√©e quand l'√©tat change
  - Si `open` devient `false` (fermeture), on appelle `onClose()`
  - Radix g√®re automatiquement la fermeture par :
    * Escape key
    * Backdrop click
    * Dialog.Close click

**Pourquoi cette syntaxe ?**

* Radix nous donne l'√©tat d√©sir√© (`open`)
* On ne veut appeler `onClose()` que lors de la fermeture (pas l'ouverture)
* `!open && onClose()` = "si open est false, appelle onClose"

---

=== Dialog.Portal - Rendu √† la racine (ligne 23)

[source,typescript]
----
<Dialog.Portal>
----

**Portal automatique :**

* Rend le contenu √† la racine du `<body>` au lieu de dans le DOM parent
* **Avantages** :
  - Pas de probl√®mes de z-index avec des containers parents
  - Pas de probl√®mes de overflow:hidden sur parents
  - Position absolute/fixed garantie de fonctionner

**√âquivalent React :**

[source,jsx]
----
// Sans Portal (‚ùå peut causer des probl√®mes)
<div className="page">
  <Modal /> {/* Rendu ici, peut √™tre coup√© par overflow */}
</div>

// Avec Portal (‚úÖ garanti de fonctionner)
<div className="page">
  {/* Modal rendue √† la racine du body via Portal */}
</div>
----

---

=== Dialog.Overlay - Backdrop (ligne 24)

[source,typescript]
----
<Dialog.Overlay className={styles.overlay} />
----

**Overlay Radix :**

* Fond semi-transparent qui couvre toute la page
* **Gestion automatique** :
  - Fermeture au clic (d√©sactivable avec `onPointerDownOutside`)
  - Animation d'entr√©e/sortie
  - Position fixed full-screen

* `className={styles.overlay}` : Nos styles SCSS (couleur, blur, animation)

---

=== Dialog.Content - Contenu principal (lignes 25-42)

[source,typescript]
----
<Dialog.Content className={`${styles.content} ${className || ''}`}>
----

**Content Radix :**

* Container du contenu de la modale
* **Gestion automatique** :
  - Focus sur ouverture
  - Pi√®ge de focus (Tab/Shift+Tab boucle)
  - Escape pour fermer
  - Scroll lock sur body
  - Restauration du focus √† la fermeture
  - Attributs ARIA (`role="dialog"`, `aria-modal="true"`)

* `className` : Combine nos styles de base + classes custom optionnelles

**Radix vs Custom - Comparaison :**

[source,tsx]
----
// ‚ùå Version custom (109 lignes)
const modalRef = useRef<HTMLDivElement>(null)

useEffect(() => {
  if (!isOpen) return

  // Sauvegarder focus actuel
  const previousFocus = document.activeElement
  modalRef.current?.focus()
  document.body.style.overflow = 'hidden'

  // Handler clavier Escape + Tab trap
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Escape') onClose()

    if (e.key === 'Tab') {
      const focusable = modalRef.current?.querySelectorAll(...)
      // Logique complexe de pi√®ge de focus
    }
  }

  document.addEventListener('keydown', handleKeyDown)

  return () => {
    document.body.style.overflow = ''
    document.removeEventListener('keydown', handleKeyDown)
    previousFocus?.focus()
  }
}, [isOpen, onClose])

// ‚úÖ Version Radix (0 lignes)
// Radix g√®re tout automatiquement !
----

---

=== Dialog.Title - Titre accessible (lignes 26-30)

[source,typescript]
----
{title && (
    <Dialog.Title className={styles.title}>
        {title}
    </Dialog.Title>
)}
----

**Title Radix :**

* `<h2>` s√©mantique automatique
* **Attributs ARIA automatiques** :
  - G√©n√®re un ID unique
  - Lie au Dialog.Content via `aria-labelledby`
* Les screen readers annoncent : "Dialog: [titre]"

**Rendu conditionnel :** Affich√© uniquement si `title` est fourni

---

=== Dialog.Description - Description accessible (lignes 31-35)

[source,typescript]
----
{description && (
    <Dialog.Description className={styles.description}>
        {description}
    </Dialog.Description>
)}
----

**Description Radix :**

* `<p>` s√©mantique automatique
* **Attributs ARIA automatiques** :
  - G√©n√®re un ID unique
  - Lie au Dialog.Content via `aria-describedby`
* Les screen readers lisent la description apr√®s le titre

---

=== Corps de la modale (ligne 37)

[source,typescript]
----
<div className={styles.body}>{children}</div>
----

**Container de contenu :**

* Div simple pour wrapper le contenu personnalis√©
* `{children}` : Tout ce qui est pass√© entre `<Modal>...</Modal>`

---

=== Dialog.Close - Bouton de fermeture (lignes 39-41)

[source,typescript]
----
<Dialog.Close className={styles.close} aria-label="Fermer">
    <span aria-hidden="true">√ó</span>
</Dialog.Close>
----

**Close Radix :**

* Bouton natif qui appelle automatiquement `onOpenChange(false)`
* **Attributs automatiques** :
  - `type="button"` (pas de submit accidentel)
  - Ferme la modale au clic

* `aria-label="Fermer"` : Label accessible (le `√ó` n'est pas explicite)

* `aria-hidden="true"` sur le symbole : Cache le `√ó` aux screen readers (utilise le label)

---

=== displayName (ligne 48)

[source,typescript]
----
Modal.displayName = "Modal"
----

**Nom du composant :** Pour React DevTools et debugging.

---

== Modal.module.scss - Styles personnalis√©s

=== Overlay (lignes 4-10)

[source,scss]
----
.overlay {
    position: fixed;
    inset: 0;
    background: rgba($black-ink, 0.5);
    backdrop-filter: blur(4px);
    z-index: 1000;
    animation: fadeIn 200ms $easing-smooth;
}
----

**Styles du backdrop :**

* `inset: 0` : Couvre tout l'√©cran (√©quivalent √† top/right/bottom/left: 0)
* `backdrop-filter: blur(4px)` : Effet de flou sur le contenu en arri√®re-plan
* `animation: fadeIn` : Apparition en fondu

---

=== Content (lignes 13-37)

[source,scss]
----
.content {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    background: $white-paper;
    border-radius: $border-radius-lg;
    box-shadow: $shadow-xl;

    width: 90vw;
    max-width: 500px;
    max-height: 85vh;
    overflow-y: auto;

    padding: $spacing-lg;
    z-index: 1001;

    animation: slideUp 200ms $easing-smooth;
----

**Styles du contenu :**

* `transform: translate(-50%, -50%)` : Centrage parfait
* `width: 90vw` + `max-width: 500px` : Responsive (mobile 90%, desktop max 500px)
* `max-height: 85vh` + `overflow-y: auto` : Scroll si contenu trop grand
* `animation: slideUp` : Glisse vers le haut en apparaissant

**Focus visible :**

[source,scss]
----
&:focus {
    outline: 2px solid $terracotta;
    outline-offset: 2px;
}
----

* **WCAG 2.4.7** : Outline visible pour navigation clavier

---

=== Animations (lignes 77-95)

[source,scss]
----
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translate(-50%, -48%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}
----

**Animations fluides :**

* `fadeIn` : Overlay appara√Æt en fondu
* `slideUp` : Content glisse vers le haut (effet moderne iOS)

---

== Conformit√© WCAG 2.2 AA

[cols="1,2,1"]
|===
|Crit√®re WCAG |Impl√©mentation |G√©r√© par

|**1.3.1 - Info et relations**
|`role="dialog"`, `aria-labelledby`, `aria-describedby`
|Radix

|**2.1.2 - Pas de pi√®ge clavier**
|Escape pour fermer, focus trap automatique
|Radix

|**2.4.3 - Ordre de focus**
|Focus sur modale √† l'ouverture, restauration √† la fermeture
|Radix

|**2.4.7 - Focus visible**
|Outline terracotta 2px au focus
|Notre SCSS

|**2.4.6 - En-t√™tes et labels**
|Titre accessible via Dialog.Title
|Radix

|**4.1.2 - Nom, r√¥le, valeur**
|`role="dialog"`, `aria-modal="true"`, labels accessibles
|Radix
|===

---

== Utilisation du composant

=== Exemple basique

[source,tsx]
----
import { Modal } from '@/components/ui/modal'
import { useState } from 'react'

function MyComponent() {
  const [isOpen, setIsOpen] = useState(false)

  return (
    <>
      <button onClick={() => setIsOpen(true)}>
        Ouvrir
      </button>

      <Modal
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
        title="Confirmer l'action"
        description="√ätes-vous s√ªr de vouloir continuer ?"
      >
        <p>Contenu de la modale</p>
        <button onClick={() => setIsOpen(false)}>
          Annuler
        </button>
      </Modal>
    </>
  )
}
----

=== Exemple avec formulaire

[source,tsx]
----
<Modal
  isOpen={isOpen}
  onClose={() => setIsOpen(false)}
  title="Modifier le profil"
>
  <form onSubmit={handleSubmit}>
    <Input label="Nom" {...register('name')} />
    <Input label="Email" {...register('email')} />

    <div style={{ display: 'flex', gap: '1rem' }}>
      <Button variant="outline" onClick={() => setIsOpen(false)}>
        Annuler
      </Button>
      <Button type="submit" variant="primary">
        Enregistrer
      </Button>
    </div>
  </form>
</Modal>
----

---

== Comparaison : Custom vs Radix

[cols="1,2,2"]
|===
|Aspect |Custom (109 lignes) |Radix (48 lignes)

|**Focus management**
|Manuel avec useEffect + useRef
|Automatique ‚úÖ

|**Keyboard navigation**
|Handler custom Escape + Tab trap
|Automatique ‚úÖ

|**Portal**
|Faut impl√©menter ReactDOM.createPortal
|Automatique ‚úÖ

|**ARIA attributes**
|IDs avec Date.now(), aria-* manuels
|Automatique ‚úÖ

|**Scroll lock**
|document.body.style.overflow manuel
|Automatique ‚úÖ

|**Bugs potentiels**
|Fuites m√©moire, stale closures, ID collision
|Aucun, test√© en prod ‚úÖ

|**Maintenance**
|√Ä notre charge
|√âquipe Radix ‚úÖ

|**Bundle size**
|~2kb (notre code)
|~4kb (Radix)

|**Accessibilit√©**
|100% si bien cod√©
|100% garanti ‚úÖ
|===

**Conclusion :** Radix = 56% moins de code, 0% de bugs, 100% d'accessibilit√© garantie.

---

== Points cl√©s

1. **Radix Dialog g√®re automatiquement** :
   - Focus trap et restauration
   - Escape key et backdrop click
   - Scroll lock
   - Attributs ARIA
   - Portal √† la racine du DOM

2. **Notre r√¥le** : Seulement les styles SCSS personnalis√©s

3. **API simple** : 7 props vs 12+ dans la version custom

4. **Fiabilit√©** : Test√© en production par des milliers d'apps

5. **Maintenance** : Radix s'occupe des edge cases et bugs

---

== R√©sum√©

**Modal avec Radix UI = Best of both worlds :**

* ‚úÖ **Accessibilit√© WCAG 2.2 AA** garantie par Radix
* ‚úÖ **Styles personnalis√©s** avec notre design system SCSS
* ‚úÖ **API simple** et intuitive
* ‚úÖ **Moins de code** = moins de bugs
* ‚úÖ **Focus sur la valeur** : On code les fonctionnalit√©s m√©tier, pas l'infrastructure

**48 lignes au lieu de 109, fiabilit√© maximale ! üéâ**
